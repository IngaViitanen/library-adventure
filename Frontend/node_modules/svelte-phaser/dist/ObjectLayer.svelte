<script>var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import { onMount } from 'svelte';
import { getTilemap } from './getTilemap';
import { getSpawner } from './getSpawner';
/**
 * The mapping for components that this layer will render
 *
 * #required
 * @type {object}
 */
export let components;
/**
 * The layer array index value, or the layer name from Tiled
 *
 * #required
 * @type {number|string}
 */
export let id;
/**
 * The depth for each component in this layer
 * @type {number}
 */
export let depth;
const spawner = getSpawner();
if (!spawner) {
    throw new Error('ObjectLayer must be inside of a <Spawner /> component');
}
const tilemap = getTilemap();
const layer = tilemap.objects.find((layer) => layer.name === id);
// @ts-ignore
if (tilemap.useLayerOrder && typeof depth === 'undefined') {
    depth =
        // @ts-ignore
        tilemap.layerOrder.findIndex((layerName) => layerName === id) +
            // @ts-ignore
            tilemap.startingDepth;
}
onMount(() => {
    if (!layer) {
        throw new Error(`Unable to find layer of id "${id}"`);
    }
    layer.objects.forEach(({ x, y, properties }) => {
        const _a = properties.reduce((total, prop) => (Object.assign(Object.assign({}, total), { [prop.name]: prop.value })), {}), { component } = _a, props = __rest(_a, ["component"]);
        if (component && components[component]) {
            // allow component map to include components imported via `import * as Component from 'Component.svelte'`
            // by checking for .default
            const c = components[component].default || components[component];
            spawner.spawn(c, Object.assign({ x,
                y,
                depth }, props));
        }
    });
});
</script>

<slot />
